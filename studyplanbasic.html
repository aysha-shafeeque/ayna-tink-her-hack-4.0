<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Multi-Subject Study Planner</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f0f4f8; margin:0; padding:20px; }
h1 { text-align:center; color:#2c3e50; }
.container { max-width:1000px; margin:auto; background:#fff; padding:25px; border-radius:15px; box-shadow:0 5px 20px rgba(0,0,0,0.1); }
label { display:block; margin-top:15px; font-weight:bold; color:#34495e; }
input, select { width:100%; padding:10px; margin-top:5px; border-radius:8px; border:1px solid #ccc; font-size:14px; }
button { margin-top:15px; padding:10px 20px; border:none; border-radius:8px; background:#3498db; color:white; cursor:pointer; font-weight:bold; }
button:hover { background:#2980b9; }
#subjectsContainer .subject-entry { display:flex; gap:10px; margin-top:10px; flex-wrap:wrap; background:#ecf0f1; padding:10px; border-radius:8px; align-items:center; }
#subjectsContainer .subject-entry input, #subjectsContainer .subject-entry select { flex:1; }
.calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:10px; margin-top:20px; }
.day-block { background:#fff; padding:10px; border-radius:12px; min-height:100px; box-shadow:0 4px 12px rgba(0,0,0,0.05); font-size:12px; display:flex; flex-direction:column; align-items:center; position:relative; transition:transform 0.2s, box-shadow 0.2s; }
.day-block:hover { transform:translateY(-3px); box-shadow:0 8px 20px rgba(0,0,0,0.1); }
.day-title { font-weight:bold; margin-bottom:5px; color:#2c3e50; font-size:13px; text-align:center; }
.subject-label { margin-top:5px; padding:5px 8px; border-radius:6px; font-size:12px; color:#fff; width:100%; text-align:center; }
.easy { background:#2ecc71; }
.medium { background:#f39c12; }
.hard { background:#e74c3c; }
</style>
</head>
<body>
<div class="container">
<h1>Smart Multi-Subject Study Planner</h1>

<label>Maximum study hours per day</label>
<input type="number" id="maxHoursPerDay" value="5" min="1" max="12">

<div id="subjectsContainer">
    <div class="subject-entry">
        <input type="text" placeholder="Subject name">
        <input type="date">
        <select>
            <option value="easy">Easy</option>
            <option value="medium">Medium</option>
            <option value="hard">Hard</option>
        </select>
        <button onclick="removeSubject(this)">Remove</button>
    </div>
</div>

<button onclick="addSubject()">Add Another Subject</button>
<button onclick="generateCalendar()">Generate Calendar</button>
<button onclick="downloadPDF()">Download PDF</button>

<div class="calendar" id="calendar"></div>
</div>

<script>
function addSubject(){
    const container = document.getElementById('subjectsContainer');
    const div = document.createElement('div');
    div.className = 'subject-entry';
    div.innerHTML = `
        <input type="text" placeholder="Subject name">
        <input type="date">
        <select>
            <option value="easy">Easy</option>
            <option value="medium">Medium</option>
            <option value="hard">Hard</option>
        </select>
        <button onclick="removeSubject(this)">Remove</button>
    `;
    container.appendChild(div);
}

function removeSubject(btn){ btn.parentElement.remove(); }

function formatHours(hoursDecimal){
    const h = Math.floor(hoursDecimal);
    const m = Math.round((hoursDecimal - h) * 60);
    return `${h}h ${m}m`;
}

function generateCalendar(){
    const maxHours = parseInt(document.getElementById('maxHoursPerDay').value) || 5;
    const entries = document.querySelectorAll('.subject-entry');
    let subjects = [];
    let maxDate = new Date();
    for(const entry of entries){
        const name = entry.children[0].value.trim();
        const date = new Date(entry.children[1].value);
        const diff = entry.children[2].value;
        if(!name || !date){ alert("Enter all fields"); return; }
        subjects.push({name, date, diff});
        if(date > maxDate) maxDate = date;
    }

    const today = new Date();
    const totalDays = Math.ceil((maxDate - today)/(1000*60*60*24));
    if(totalDays<=0){ alert("Check dates"); return; }

    const calendarDiv = document.getElementById('calendar');
    calendarDiv.innerHTML = '';

    function getHoursWeight(diff){ if(diff==='easy') return 1; if(diff==='medium') return 2; return 3; }

    for(let i=0;i<=totalDays;i++){
        const day = new Date(today.getTime() + i*24*60*60*1000);
        const dayStr = day.toDateString().split(' ').slice(1,3).join(' ');
        const div = document.createElement('div');
        div.className = 'day-block';
        div.innerHTML = `<div class="day-title">${dayStr}</div>`;

        const availableSubjects = subjects.filter(s => day <= s.date);
        if(availableSubjects.length===0) continue;

        let totalWeight = 0;
        availableSubjects.forEach(s=>totalWeight+=getHoursWeight(s.diff));

        availableSubjects.forEach(s=>{
            const weight = getHoursWeight(s.diff);
            let hours = (weight/totalWeight)*maxHours;
            const subDiv = document.createElement('div');
            subDiv.className = 'subject-label ' + s.diff;
            subDiv.innerText = `${s.name}: ${formatHours(hours)}`;
            div.appendChild(subDiv);
        });

        calendarDiv.appendChild(div);
    }
}

function downloadPDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('l','pt','a4');
    const calendarDiv = document.getElementById('calendar');
    if(!calendarDiv.innerHTML){ alert("Generate calendar first"); return; }

    const blocks = calendarDiv.querySelectorAll('.day-block');
    let yStart = 40;
    blocks.forEach((block,i)=>{
        const col = i%7;
        const row = Math.floor(i/7);
        const blockHeight = 60 + block.children.length*20;
        const x = 30 + col*140;
        const y = yStart + row*(blockHeight + 10);

        // Card background
        doc.setFillColor(255,255,255);
        doc.setDrawColor(200,200,200);
        doc.roundedRect(x, y, 130, blockHeight, 8, 8, 'FD');

        // Day title
        doc.setFontSize(12);
        doc.setTextColor(44,62,80);
        doc.text(block.children[0].innerText, x+65, y+20, {align:'center'});

        // Subjects
        let offsetY = 40;
        for(let j=1;j<block.children.length;j++){
            const subj = block.children[j];
            const bgColor = window.getComputedStyle(subj).backgroundColor.match(/\d+/g).map(Number);
            doc.setFillColor(bgColor[0], bgColor[1], bgColor[2]);
            doc.roundedRect(x+5, y+offsetY-10, 120, 18, 5, 5, 'F');
            doc.setTextColor(255,255,255);
            doc.setFontSize(10);
            doc.text(subj.innerText, x+65, y+offsetY+3, {align:'center'});
            offsetY += 22;
        }
    });
    doc.save("SmartStudyPlan.pdf");
}
</script>
</body>
</html>